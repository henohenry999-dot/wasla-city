<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© ÙˆØµÙ„Ø© | Ø¯Ù„ÙŠÙ„ Ø­Ø¯Ø§Ø¦Ù‚ Ø§Ù„Ø¹Ø§ØµÙ…Ø©</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root { --primary: #273c75; --secondary: #4cd137; --accent: #fbc531; --bg: #f5f6fa; --text: #2f3640; --white: #ffffff; }
        body { font-family: 'Cairo', sans-serif; margin: 0; background-color: var(--bg); color: var(--text); padding-bottom: 90px; }
        header { background: linear-gradient(135deg, var(--primary), #192a56); color: var(--white); padding: 20px; border-bottom-left-radius: 25px; border-bottom-right-radius: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .logo h1 { margin: 0; font-size: 1.8rem; } .logo span { color: var(--accent); }
        .btn-advertise { background: rgba(255,255,255,0.2); color: white; padding: 6px 15px; border-radius: 20px; text-decoration: none; font-size: 0.85rem; border: 1px solid rgba(255,255,255,0.3); display: inline-flex; align-items: center; gap: 5px; }
        .search-container { background: var(--white); padding: 15px; margin: -25px 15px 10px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); display: flex; gap: 10px; flex-wrap: wrap; }
        .search-box, .area-select { flex: 1; border: 1px solid #ddd; padding: 10px; border-radius: 10px; outline: none; font-family: 'Cairo', sans-serif; }
        .categories-wrapper { overflow-x: auto; white-space: nowrap; padding: 10px 15px; scrollbar-width: none; }
        .categories-wrapper::-webkit-scrollbar { display: none; }
        .cat-chip { display: inline-block; padding: 8px 16px; background: var(--white); border: 1px solid #e1e1e1; border-radius: 25px; margin-left: 8px; cursor: pointer; color: #718093; transition: 0.3s; }
        .cat-chip.active { background: var(--primary); color: white; border-color: var(--primary); }
        .container { padding: 15px; max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .card { background: var(--white); border-radius: 15px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.03); position: relative; display: flex; flex-direction: column; }
        .card.featured { border: 2px solid var(--accent); }
        .featured-badge { position: absolute; top: 10px; right: 10px; background: var(--accent); color: var(--primary); padding: 4px 10px; border-radius: 20px; font-size: 0.7rem; font-weight: bold; z-index: 2; }
        .card-img-container { height: 160px; background: #eee; }
        .card-img { width: 100%; height: 100%; object-fit: cover; }
        .card-body { padding: 15px; flex-grow: 1; }
        .card h3 { margin: 0; font-size: 1.1rem; color: var(--primary); }
        .tags { display: flex; gap: 5px; margin-bottom: 10px; }
        .tag { font-size: 0.7rem; padding: 2px 8px; border-radius: 4px; background: #f1f2f6; }
        .card-footer { padding: 10px 15px; background: #fdfdfd; border-top: 1px solid #f1f2f6; display: flex; gap: 10px; }
        .btn { flex: 1; padding: 8px; border-radius: 8px; text-align: center; text-decoration: none; display: block; font-size: 0.9rem; font-weight: bold; }
        .btn-call { background: var(--secondary); color: white; }
        .btn-details { background: #dfe4ea; color: var(--text); }
        .loading-spinner { text-align: center; padding: 40px; color: var(--primary); grid-column: 1/-1; }
        .error-msg { text-align: center; padding: 20px; color: red; background: #ffebeb; border-radius: 10px; grid-column: 1/-1; }
        .modal { display: none; position: fixed; z-index: 1000; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); overflow-y: auto; }
        .modal-content { background: white; margin: 5% auto; width: 90%; max-width: 600px; border-radius: 20px; overflow: hidden; position: relative; }
        .close-modal { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.5); color: white; width: 30px; height: 30px; border-radius: 50%; text-align: center; line-height: 30px; cursor: pointer; }
        .fab-container { position: fixed; bottom: 20px; left: 20px; z-index: 99; }
        .fab-btn { background: var(--primary); color: white; padding: 12px 20px; border-radius: 30px; text-decoration: none; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.3); display: flex; align-items: center; gap: 8px; }
    </style>
</head>
<body>

<header>
    <div class="header-top">
        <div class="logo"><h1>ÙˆØµÙ„Ø© <span>.</span></h1><small>Ø¯Ù„ÙŠÙ„ Ø­Ø¯Ø§Ø¦Ù‚ Ø§Ù„Ø¹Ø§ØµÙ…Ø©</small></div>
        <div class="header-actions"><a href="https://forms.gle/iGmmzXMt9amqkepu7" target="_blank" class="btn-advertise"><i class="fas fa-plus-circle"></i> Ø£Ø¶Ù Ù†Ø´Ø§Ø·Ùƒ</a></div>
    </div>
</header>

<div class="search-container">
    <input type="text" id="searchInput" class="search-box" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† (Ù…Ø·Ø¹Ù…ØŒ Ø³Ø¨Ø§Ùƒ)...">
    <select id="areaFilter" class="area-select">
        <option value="all">ğŸ“ ÙƒÙ„ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</option>
        <option value="Ø­ÙŠ Ø§Ù„Ø²Ù‡ÙˆØ±">Ø­ÙŠ Ø§Ù„Ø²Ù‡ÙˆØ±</option>
        <option value="Ø­ÙŠ Ø§Ù„ÙŠØ§Ø³Ù…ÙŠÙ†">Ø­ÙŠ Ø§Ù„ÙŠØ§Ø³Ù…ÙŠÙ†</option>
        <option value="Ø­ÙŠ Ø§Ù„Ù‚Ø±Ù†ÙÙ„">Ø­ÙŠ Ø§Ù„Ù‚Ø±Ù†ÙÙ„</option>
        <option value="Ø®Ø¯Ù…Ø§Øª Ù…Ø±ÙƒØ²ÙŠØ©">Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª</option>
    </select>
</div>

<div class="categories-wrapper">
    <div class="cat-chip active" onclick="filterCategory('all', this)">Ø§Ù„ÙƒÙ„</div>
    <div class="cat-chip" onclick="filterCategory('medical', this)">Ø·Ø¨ ÙˆØµØ­Ø©</div>
    <div class="cat-chip" onclick="filterCategory('food', this)">Ù…Ø·Ø§Ø¹Ù…</div>
    <div class="cat-chip" onclick="filterCategory('market', this)">Ù…Ø§Ø±ÙƒØª</div>
    <div class="cat-chip" onclick="filterCategory('maintenance', this)">ØµÙŠØ§Ù†Ø©</div>
    <div class="cat-chip" onclick="filterCategory('transport', this)">Ù…ÙˆØ§ØµÙ„Ø§Øª</div>
    <div class="cat-chip" onclick="filterCategory('education', this)">ØªØ¹Ù„ÙŠÙ…</div>
    <div class="cat-chip" onclick="filterCategory('fashion', this)">Ù…Ù„Ø§Ø¨Ø³</div>
</div>

<div class="container" id="listingsGrid">
    <div class="loading-spinner"><i class="fas fa-circle-notch fa-spin"></i><p>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p></div>
</div>

<div class="fab-container"><a href="https://forms.gle/iGmmzXMt9amqkepu7" target="_blank" class="fab-btn"><i class="fas fa-plus"></i> Ø£Ø¶Ù Ù†Ø´Ø§Ø·Ùƒ Ù…Ø¬Ø§Ù†Ø§Ù‹</a></div>

<div id="detailsModal" class="modal">
    <div class="modal-content">
        <div class="close-modal" onclick="closeModal()">Ã—</div>
        <img id="modalImg" src="" style="width:100%; height:250px; object-fit:cover;">
        <div style="padding: 20px;">
            <h2 id="modalTitle" style="color:var(--primary); margin-top:0;"></h2>
            <div style="margin-bottom:15px;"><span id="modalArea" class="tag" style="background:#e3f2fd;"></span> <span id="modalCat" class="tag"></span></div>
            <p id="modalDesc" style="line-height:1.6; color:#555;"></p>
            <br>
            <div style="display:flex; gap:10px;">
                <a id="modalCall" href="#" class="btn btn-call">Ø§ØªØµØ§Ù„</a>
                <a id="modalWa" href="#" class="btn" style="background:#25D366; color:white;" target="_blank">ÙˆØ§ØªØ³Ø§Ø¨</a>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<script>
    // âœ… Ø§Ù„Ø­Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙˆØ³ÙŠØ· (Proxy) Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªØ­Ù…ÙŠÙ„
    const rawSheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQxk-tGJ65-hOGtlnVUHDmDUohw1zFIFLDlIng-OlmH35mti_kqInGBCl3gNpUUeL9j5VRMx_x7A8bn/pub?output=csv";
    const sheetURL = "https://api.allorigins.win/raw?url=" + encodeURIComponent(rawSheetURL);

    const grid = document.getElementById('listingsGrid');
    const modal = document.getElementById('detailsModal');
    let services = [];

    function convertDriveImage(url) {
        if (!url || url.trim() === '') return 'https://via.placeholder.com/400x200?text=ÙˆØµÙ„Ø©';
        let cleanUrl = url.split(',')[0].trim();
        let id = "";
        const match1 = cleanUrl.match(/id=([a-zA-Z0-9_-]+)/);
        const match2 = cleanUrl.match(/\/d\/([a-zA-Z0-9_-]+)/);
        if (match1) id = match1[1]; else if (match2) id = match2[1];
        if (id) return `https://drive.google.com/thumbnail?id=${id}&sz=w600`;
        return cleanUrl;
    }

    function loadData() {
        Papa.parse(sheetURL, {
            download: true,
            header: false, // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ÙˆØ§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ Ø§Ù„ØªØ±ØªÙŠØ¨
            skipEmptyLines: true,
            complete: function(results) {
                // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ (Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†)
                const rawData = results.data.slice(1); 
                
                if(rawData.length === 0) {
                    grid.innerHTML = '<div class="no-results">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</div>';
                    return;
                }

                services = rawData.map((row, index) => ({
                    id: index,
                    // Ø§Ù„ØªØ±ØªÙŠØ¨: 1:Ø§Ù„Ø§Ø³Ù…, 2:Ø§Ù„ØªØµÙ†ÙŠÙ, 3:Ø§Ù„Ù…Ù†Ø·Ù‚Ø©, 4:Ø§Ù„ÙˆØµÙ, 5:Ù…ÙˆØ¨Ø§ÙŠÙ„, 6:ÙˆØ§ØªØ³, 7:ØµÙˆØ±Ø©
                    name: row[1],
                    category: mapCategory(row[2]),
                    area: row[3] || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                    desc: row[4] || 'Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„',
                    phone: row[5],
                    whatsapp: row[6],
                    image: convertDriveImage(row[7]),
                    is_featured: (row[8] && (row[8].includes('true') || row[8].includes('Ù†Ø¹Ù…'))) || false
                })).filter(item => item.name); // ÙÙ„ØªØ±Ø© Ø§Ù„ØµÙÙˆÙ Ø§Ù„ÙØ§Ø±ØºØ©

                render();
            },
            error: function(err) {
                console.error("Error:", err);
                grid.innerHTML = '<div class="error-msg">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.<br>ØªØ£ÙƒØ¯ Ù…Ù† Ù†Ø´Ø± Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³ÙŠÙ„ ÙƒÙ€ CSV.</div>';
            }
        });
    }

    function mapCategory(ar) {
        if(!ar) return "other";
        const n = ar.trim();
        if(n.includes("Ø·Ø¨") || n.includes("ØµØ­Ø©")) return "medical";
        if(n.includes("Ø£ÙƒÙ„") || n.includes("Ù…Ø·Ø§Ø¹Ù…")) return "food";
        if(n.includes("Ù…Ø§Ø±ÙƒØª") || n.includes("Ø¨Ù‚Ø§Ù„Ø©")) return "market";
        if(n.includes("ØµÙŠØ§Ù†Ø©")) return "maintenance";
        if(n.includes("Ù…ÙˆØ§ØµÙ„Ø§Øª")) return "transport";
        if(n.includes("ØªØ¹Ù„ÙŠÙ…")) return "education";
        if(n.includes("Ù…Ù„Ø§Ø¨Ø³")) return "fashion";
        return "other";
    }

    let currentCategory = 'all', currentSearch = '', currentArea = 'all';

    function render() {
        grid.innerHTML = '';
        let filtered = services.filter(item => {
            return (currentCategory === 'all' || item.category === currentCategory) &&
                   (currentArea === 'all' || item.area === currentArea) &&
                   (item.name.includes(currentSearch) || item.desc.includes(currentSearch));
        });

        filtered.sort((a, b) => (a.is_featured === b.is_featured) ? 0 : a.is_featured ? -1 : 1);

        if (filtered.length === 0) {
            grid.innerHTML = '<div class="no-results">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬.</div>';
            return;
        }

        filtered.forEach(item => {
            const badge = item.is_featured ? `<div class="featured-badge">ğŸ‘‘ Ù…Ø±ÙˆØ¬</div>` : '';
            const featuredClass = item.is_featured ? 'featured' : '';
            const card = `
                <div class="card ${featuredClass}" onclick="openModal(${item.id})">
                    ${badge}
                    <div class="card-img-container"><img src="${item.image}" class="card-img" loading="lazy"></div>
                    <div class="card-body">
                        <h3>${item.name}</h3>
                        <div class="tags"><span class="tag" style="background:#e3f2fd;">${item.area}</span></div>
                        <p style="font-size:0.9rem; color:#666;">${item.desc.substring(0, 50)}...</p>
                    </div>
                    <div class="card-footer">
                        <span class="btn btn-details">Ø§Ù„ØªÙØ§ØµÙŠÙ„</span>
                        ${item.phone ? `<a href="tel:${item.phone}" onclick="event.stopPropagation()" class="btn btn-call"><i class="fas fa-phone"></i></a>` : ''}
                    </div>
                </div>`;
            grid.innerHTML += card;
        });
    }

    function filterCategory(cat, el) {
        currentCategory = cat;
        document.querySelectorAll('.cat-chip').forEach(c => c.classList.remove('active'));
        el.classList.add('active');
        render();
    }
    document.getElementById('searchInput').addEventListener('input', (e) => { currentSearch = e.target.value; render(); });
    document.getElementById('areaFilter').addEventListener('change', (e) => { currentArea = e.target.value; render(); });

    function openModal(id) {
        const item = services.find(s => s.id === id);
        document.getElementById('modalTitle').innerText = item.name;
        document.getElementById('modalImg').src = item.image.replace('sz=w600', 'sz=w800');
        document.getElementById('modalDesc').innerText = item.desc;
        document.getElementById('modalArea').innerText = item.area;
        document.getElementById('modalCall').href = `tel:${item.phone}`;
        document.getElementById('modalWa').href = `https://wa.me/${item.whatsapp}`;
        modal.style.display = 'block';
    }
    function closeModal() { modal.style.display = 'none'; }
    window.onclick = (e) => { if(e.target == modal) closeModal(); }

    loadData();
</script>
</body>
</html>
