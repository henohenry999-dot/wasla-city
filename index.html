<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© ÙˆØµÙ„Ø© | Ø¯Ù„ÙŠÙ„ Ø­Ø¯Ø§Ø¦Ù‚ Ø§Ù„Ø¹Ø§ØµÙ…Ø©</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --primary: #273c75;
            --secondary: #4cd137;
            --accent: #fbc531;
            --bg: #f5f6fa;
            --text: #2f3640;
            --white: #ffffff;
        }

        body { font-family: 'Cairo', sans-serif; margin: 0; background-color: var(--bg); color: var(--text); padding-bottom: 90px; }

        header { background: linear-gradient(135deg, var(--primary), #192a56); color: var(--white); padding: 20px; border-bottom-left-radius: 25px; border-bottom-right-radius: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .logo h1 { margin: 0; font-size: 1.8rem; }
        .logo span { color: var(--accent); }
        .header-actions .btn-advertise { background: rgba(255,255,255,0.2); color: white; padding: 6px 15px; border-radius: 20px; text-decoration: none; font-size: 0.85rem; border: 1px solid rgba(255,255,255,0.3); transition: 0.3s; display: inline-flex; align-items: center; gap: 5px; }
        .header-actions .btn-advertise:hover { background: var(--accent); color: var(--primary); border-color: var(--accent); }

        .search-container { background: var(--white); padding: 15px; margin: -25px 15px 10px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); display: flex; gap: 10px; flex-wrap: wrap; }
        .search-box { flex: 2; min-width: 150px; border: 1px solid #ddd; padding: 10px 15px; border-radius: 10px; outline: none; font-family: 'Cairo', sans-serif; }
        .area-select { flex: 1; min-width: 100px; border: 1px solid #ddd; padding: 10px; border-radius: 10px; background: white; font-family: 'Cairo', sans-serif; cursor: pointer; }

        .categories-wrapper { overflow-x: auto; white-space: nowrap; padding: 10px 15px; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
        .categories-wrapper::-webkit-scrollbar { display: none; }
        .cat-chip { display: inline-block; padding: 8px 16px; background: var(--white); border: 1px solid #e1e1e1; border-radius: 25px; margin-left: 8px; cursor: pointer; transition: 0.3s; font-size: 0.9rem; color: #718093; }
        .cat-chip.active { background: var(--primary); color: var(--white); border-color: var(--primary); box-shadow: 0 3px 10px rgba(39, 60, 117, 0.3); }
        .cat-chip i { margin-left: 5px; }

        .container { padding: 15px; max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; }
        .card { background: var(--white); border-radius: 15px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.03); transition: 0.3s; position: relative; border: 1px solid transparent; display: flex; flex-direction: column; }
        .card.featured { border: 2px solid var(--accent); box-shadow: 0 5px 20px rgba(251, 197, 49, 0.15); }
        .featured-badge { position: absolute; top: 10px; right: 10px; background: var(--accent); color: var(--primary); padding: 4px 10px; border-radius: 20px; font-size: 0.7rem; font-weight: bold; z-index: 2; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .card:hover { transform: translateY(-5px); }
        .card-img-container { height: 160px; position: relative; background: #eee; overflow: hidden; }
        .card-img { width: 100%; height: 100%; object-fit: cover; transition: opacity 0.3s; }
        .card-body { padding: 15px; flex-grow: 1; }
        .card-title-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .card h3 { margin: 0; font-size: 1.1rem; color: var(--primary); }
        .rating { color: #f1c40f; font-size: 0.8rem; }
        .tags { display: flex; gap: 5px; margin-bottom: 10px; flex-wrap: wrap; }
        .tag { font-size: 0.7rem; padding: 2px 8px; border-radius: 4px; background: #f1f2f6; color: #57606f; }
        .tag-area { background: #e3f2fd; color: var(--primary); }
        .card-desc { font-size: 0.9rem; color: #747d8c; margin-bottom: 15px; line-height: 1.5; }
        .card-footer { padding: 10px 15px; background: #fdfdfd; border-top: 1px solid #f1f2f6; display: flex; gap: 10px; }
        .btn { flex: 1; padding: 8px; border-radius: 8px; text-align: center; text-decoration: none; font-size: 0.9rem; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 5px; transition: 0.2s; cursor: pointer; }
        .btn-call { background: var(--secondary); color: white; }
        .btn-details { background: #dfe4ea; color: var(--text); }
        .btn:hover { opacity: 0.9; }

        .loading-spinner { text-align: center; padding: 40px; color: var(--primary); grid-column: 1/-1; }
        .loading-spinner i { font-size: 2rem; margin-bottom: 15px; }

        .modal { display: none; position: fixed; z-index: 1000; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); backdrop-filter: blur(4px); overflow-y: auto; }
        .modal-content { background: white; margin: 5% auto; width: 95%; max-width: 600px; border-radius: 20px; overflow: hidden; animation: slideUp 0.3s; position: relative; }
        @keyframes slideUp { from {transform: translateY(20px); opacity: 0;} to {transform: translateY(0); opacity: 1;} }
        .close-modal { position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.6); color: white; width: 30px; height: 30px; border-radius: 50%; text-align: center; line-height: 30px; cursor: pointer; z-index: 10; font-size: 1.2rem; }
        
        .fab-container { position: fixed; bottom: 20px; left: 20px; display: flex; flex-direction: column; gap: 10px; z-index: 99; }
        .fab-btn { background: var(--primary); color: white; padding: 12px 20px; border-radius: 30px; text-decoration: none; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.3); display: flex; align-items: center; gap: 8px; transition: 0.3s; font-size: 0.9rem; }
        .fab-btn:hover { transform: scale(1.05); }

        .no-results { text-align: center; grid-column: 1/-1; padding: 40px; color: #a4b0be; }
        .no-results i { font-size: 3rem; margin-bottom: 10px; display: block; }
    </style>
</head>
<body>

<header>
    <div class="header-top">
        <div class="logo">
            <h1>ÙˆØµÙ„Ø© <span>.</span></h1>
            <small style="opacity: 0.8;">Ø¯Ù„ÙŠÙ„ Ø­Ø¯Ø§Ø¦Ù‚ Ø§Ù„Ø¹Ø§ØµÙ…Ø©</small>
        </div>
        <div class="header-actions">
            <a href="https://forms.gle/iGmmzXMt9amqkepu7" target="_blank" class="btn-advertise"><i class="fas fa-plus-circle"></i> Ø£Ø¶Ù Ù†Ø´Ø§Ø·Ùƒ</a>
        </div>
    </div>
</header>

<div class="search-container">
    <input type="text" id="searchInput" class="search-box" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† (Ù…Ø·Ø¹Ù…ØŒ Ø³Ø¨Ø§ÙƒØŒ Ø¯ÙƒØªÙˆØ±)...">
    <select id="areaFilter" class="area-select">
        <option value="all">ğŸ“ ÙƒÙ„ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</option>
        <option value="Ø­ÙŠ Ø§Ù„Ø²Ù‡ÙˆØ±">Ø­ÙŠ Ø§Ù„Ø²Ù‡ÙˆØ±</option>
        <option value="Ø­ÙŠ Ø§Ù„ÙŠØ§Ø³Ù…ÙŠÙ†">Ø­ÙŠ Ø§Ù„ÙŠØ§Ø³Ù…ÙŠÙ†</option>
        <option value="Ø­ÙŠ Ø§Ù„Ù‚Ø±Ù†ÙÙ„">Ø­ÙŠ Ø§Ù„Ù‚Ø±Ù†ÙÙ„</option>
        <option value="Ø®Ø¯Ù…Ø§Øª Ù…Ø±ÙƒØ²ÙŠØ©">Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª</option>
    </select>
</div>

<div class="categories-wrapper">
    <div class="cat-chip active" onclick="filterCategory('all', this)"><i class="fas fa-border-all"></i> Ø§Ù„ÙƒÙ„</div>
    <div class="cat-chip" onclick="filterCategory('medical', this)"><i class="fas fa-user-md"></i> Ø·Ø¨ ÙˆØµØ­Ø©</div>
    <div class="cat-chip" onclick="filterCategory('food', this)"><i class="fas fa-utensils"></i> Ù…Ø·Ø§Ø¹Ù…</div>
    <div class="cat-chip" onclick="filterCategory('market', this)"><i class="fas fa-shopping-basket"></i> Ù…Ø§Ø±ÙƒØª</div>
    <div class="cat-chip" onclick="filterCategory('maintenance', this)"><i class="fas fa-wrench"></i> ØµÙŠØ§Ù†Ø©</div>
    <div class="cat-chip" onclick="filterCategory('transport', this)"><i class="fas fa-car"></i> Ù…ÙˆØ§ØµÙ„Ø§Øª</div>
    <div class="cat-chip" onclick="filterCategory('education', this)"><i class="fas fa-graduation-cap"></i> ØªØ¹Ù„ÙŠÙ…</div>
    <div class="cat-chip" onclick="filterCategory('fashion', this)"><i class="fas fa-tshirt"></i> Ù…Ù„Ø§Ø¨Ø³</div>
</div>

<div class="container" id="listingsGrid">
    <div class="loading-spinner">
        <i class="fas fa-circle-notch fa-spin"></i>
        <p>Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø³ÙƒØ§Ù† Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©...</p>
    </div>
</div>

<div class="fab-container">
    <a href="https://forms.gle/iGmmzXMt9amqkepu7" target="_blank" class="fab-btn add">
        <i class="fas fa-plus"></i> Ø£Ø¶Ù Ù†Ø´Ø§Ø·Ùƒ Ù…Ø¬Ø§Ù†Ø§Ù‹
    </a>
</div>

<div id="detailsModal" class="modal">
    <div class="modal-content">
        <div class="close-modal" onclick="closeModal()">Ã—</div>
        <img id="modalImg" src="" style="width:100%; height:250px; object-fit:cover;">
        <div style="padding: 20px;">
            <h2 id="modalTitle" style="color:var(--primary); margin-top:0;"></h2>
            <div style="margin-bottom:15px;">
                <span id="modalArea" class="tag tag-area"></span>
                <span id="modalCat" class="tag"></span>
            </div>
            <p id="modalDesc" style="line-height:1.6; color:#555;"></p>
            <br>
            <div style="display:flex; gap:10px;">
                <a id="modalCall" href="#" class="btn btn-call" style="flex:2;"><i class="fas fa-phone"></i> Ø§ØªØµÙ„ Ø§Ù„Ø¢Ù†</a>
                <a id="modalWa" href="#" class="btn" style="background:#25D366; color:white; flex:1;" target="_blank"><i class="fab fa-whatsapp"></i></a>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

<script>
    // âœ… Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ø°ÙŠ Ø£Ø±Ø³Ù„ØªÙ‡ (ÙŠØ¹Ù…Ù„ 100%)
    const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQxk-tGJ65-hOGtlnVUHDmDUohw1zFIFLDlIng-OlmH35mti_kqInGBCl3gNpUUeL9j5VRMx_x7A8bn/pub?output=csv";

    const grid = document.getElementById('listingsGrid');
    const modal = document.getElementById('detailsModal');
    let services = [];

    // --- Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„ØµÙˆØ± Ø§Ù„Ø°ÙƒÙŠ ---
    function convertDriveImage(url) {
        if (!url || url.trim() === '') return 'https://via.placeholder.com/400x200?text=ÙˆØµÙ„Ø©';
        let cleanUrl = url.split(',')[0].trim();
        let id = "";
        const match1 = cleanUrl.match(/id=([a-zA-Z0-9_-]+)/);
        const match2 = cleanUrl.match(/\/d\/([a-zA-Z0-9_-]+)/);
        if (match1) id = match1[1];
        else if (match2) id = match2[1];
        if (id) return `https://drive.google.com/thumbnail?id=${id}&sz=w600`;
        return cleanUrl; 
    }

    // --- Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©) ---
    function loadData() {
        Papa.parse(sheetURL, {
            download: true,
            header: false, // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†
            skipEmptyLines: true,
            complete: function(results) {
                // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„
                const rawData = results.data.slice(1);

                services = rawData
                    .filter(row => row[1] && row[1].trim() !== '')
                    .map((row, index) => ({
                        id: index,
                        // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©:
                        name: row[1],          // Ø§Ù„Ø§Ø³Ù…
                        category: mapCategory(row[2]), // Ø§Ù„ØªØµÙ†ÙŠÙ
                        area: row[3] || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',     // Ø§Ù„Ù…Ù†Ø·Ù‚Ø©
                        desc: row[4] || 'Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ù…ØªÙˆÙØ±Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„', // Ø§Ù„ÙˆØµÙ
                        phone: row[5],         // Ù…ÙˆØ¨Ø§ÙŠÙ„
                        whatsapp: row[6],      // ÙˆØ§ØªØ³Ø§Ø¨
                        image: convertDriveImage(row[7]), // Ø§Ù„ØµÙˆØ±Ø©
                        // Ø§Ù„Ù…Ù…ÙŠØ² (Ø§Ù„Ø¹Ù…ÙˆØ¯ 8)
                        is_featured: (row[8] && (row[8].toLowerCase().includes('true') || row[8].includes('Ù†Ø¹Ù…'))) || false,
                        rating: 5.0
                    }));
                
                render();
            },
            error: function(err) {
                grid.innerHTML = '<div class="no-results">ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·.</div>';
            }
        });
    }

    // --- ØªØ±Ø¬Ù…Ø© Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª ---
    function mapCategory(arabicName) {
        if(!arabicName) return "other";
        const n = arabicName.trim();
        if(n.includes("Ø·Ø¨") || n.includes("ØµØ­Ø©") || n.includes("Ø¹ÙŠØ§Ø¯Ø©")) return "medical";
        if(n.includes("Ù…Ø·Ø§Ø¹Ù…") || n.includes("Ø£ÙƒÙ„")) return "food";
        if(n.includes("Ù…Ø§Ø±ÙƒØª") || n.includes("Ø¨Ù‚Ø§Ù„Ø©")) return "market";
        if(n.includes("ØµÙŠØ§Ù†Ø©") || n.includes("Ø®Ø¯Ù…Ø§Øª")) return "maintenance";
        if(n.includes("Ù…ÙˆØ§ØµÙ„Ø§Øª") || n.includes("Ù†Ù‚Ù„")) return "transport";
        if(n.includes("ØªØ¹Ù„ÙŠÙ…") || n.includes("Ù…ÙƒØªØ¨Ø©")) return "education";
        if(n.includes("Ù…Ù„Ø§Ø¨Ø³")) return "fashion";
        return "other";
    }

    // --- Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ÙÙ„ØªØ±Ø© ---
    let currentCategory = 'all';
    let currentSearch = '';
    let currentArea = 'all';

    // --- Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø³Ù… ---
    function render() {
        grid.innerHTML = '';
        
        let filtered = services.filter(item => {
            const matchCat = currentCategory === 'all' || item.category === currentCategory;
            const matchArea = currentArea === 'all' || item.area === currentArea;
            const matchSearch = (item.name && item.name.toLowerCase().includes(currentSearch.toLowerCase())) || 
                                (item.desc && item.desc.toLowerCase().includes(currentSearch.toLowerCase()));
            return matchCat && matchArea && matchSearch;
        });

        // ØªØ±ØªÙŠØ¨: Ø§Ù„Ù…Ù…ÙŠØ² Ø£ÙˆÙ„Ø§Ù‹
        filtered.sort((a, b) => (a.is_featured === b.is_featured) ? 0 : a.is_featured ? -1 : 1);

        if (filtered.length === 0) {
            grid.innerHTML = `<div class="no-results"><i class="far fa-sad-tear"></i>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©</div>`;
            return;
        }

        filtered.forEach(item => {
            const badge = item.is_featured ? `<div class="featured-badge"><i class="fas fa-crown"></i> Ù…Ø±ÙˆØ¬</div>` : '';
            const featuredClass = item.is_featured ? 'featured' : '';
            
            const card = `
                <div class="card ${featuredClass}" onclick="openModal(${item.id})">
                    ${badge}
                    <div class="card-img-container">
                        <img src="${item.image}" class="card-img" loading="lazy" onerror="this.src='https://via.placeholder.com/400x200?text=ÙˆØµÙ„Ø©'">
                    </div>
                    <div class="card-body">
                        <div class="card-title-row">
                            <h3>${item.name}</h3>
                            <div class="rating"><i class="fas fa-star"></i> 5.0</div>
                        </div>
                        <div class="tags">
                            <span class="tag tag-area"><i class="fas fa-map-marker-alt"></i> ${item.area}</span>
                        </div>
                        <p class="card-desc">${item.desc.substring(0, 50)}...</p>
                    </div>
                    <div class="card-footer">
                        <span class="btn btn-details">Ø§Ù„ØªÙØ§ØµÙŠÙ„</span>
                        ${item.phone ? `<a href="tel:${item.phone}" onclick="event.stopPropagation()" class="btn btn-call"><i class="fas fa-phone"></i></a>` : ''}
                    </div>
                </div>
            `;
            grid.innerHTML += card;
        });
    }

    // --- Ø§Ù„ØªØ­ÙƒÙ… ---
    function filterCategory(cat, element) {
        currentCategory = cat;
        document.querySelectorAll('.cat-chip').forEach(el => el.classList.remove('active'));
        element.classList.add('active');
        render();
    }
    document.getElementById('searchInput').addEventListener('input', (e) => { currentSearch = e.target.value; render(); });
    document.getElementById('areaFilter').addEventListener('change', (e) => { currentArea = e.target.value; render(); });

    // --- Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© ---
    function openModal(id) {
        const item = services.find(s => s.id === id);
        document.getElementById('modalTitle').innerText = item.name;
        document.getElementById('modalImg').src = item.image.replace('sz=w600', 'sz=w800');
        document.getElementById('modalImg').onerror = function() { this.src='https://via.placeholder.com/600x300?text=ÙˆØµÙ„Ø©'; };
        document.getElementById('modalDesc').innerText = item.desc;
        document.getElementById('modalArea').innerText = item.area;
        document.getElementById('modalCat').innerText = mapCategory(item.category);
        document.getElementById('modalCall').href = `tel:${item.phone}`;
        document.getElementById('modalWa').href = `https://wa.me/${item.whatsapp}`;
        modal.style.display = 'block';
        document.body.style.overflow = 'hidden';
    }
    function closeModal() { modal.style.display = 'none'; document.body.style.overflow = 'auto'; }
    window.onclick = (e) => { if(e.target == modal) closeModal(); }
    
    // ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    loadData();
</script>

</body>
</html>
